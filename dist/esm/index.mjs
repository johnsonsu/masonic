function e(e){var t=e.high;e.L===W&&e.R===W?e.max=t:e.L===W?e.max=Math.max(e.R.max,t):e.R===W?e.max=Math.max(e.L.max,t):e.max=Math.max(Math.max(e.L.max,e.R.max),t)}function t(t){for(var r=t;r.P!==W;)e(r.P),r=r.P}function r(t,r){if(r.R!==W){var i=r.R;r.R=i.L,i.L!==W&&(i.L.P=r),i.P=r.P,r.P===W?t.root=i:r===r.P.L?r.P.L=i:r.P.R=i,i.L=r,r.P=i,e(r),e(i)}}function i(t,r){if(r.L!==W){var i=r.L;r.L=i.R,i.R!==W&&(i.R.P=r),i.P=r.P,r.P===W?t.root=i:r===r.P.R?r.P.R=i:r.P.L=i,i.R=r,r.P=i,e(r),e(i)}}function o(e,t,r){t.P===W?e.root=r:t===t.P.L?t.P.L=r:t.P.R=r,r.P=t.P}function n(){var n={root:W,size:0},a={};return{insert(o,s,l){for(var u=n.root,f=W;u!==W&&o!==(f=u).low;)u=o<u.low?u.L:u.R;if(o===f.low&&f!==W){if(!function(e,t,r){for(var i,o=e.list;o;){if(o.index===r)return 0;if(t>o.high)break;i=o,o=o.next}return i||(e.list={index:r,high:t,next:o}),i&&(i.next={index:r,high:t,next:i.next}),1}(f,s,l))return;return f.high=Math.max(f.high,s),e(f),t(f),a[l]=f,void n.size++}var v={low:o,high:s,max:s,C:0,P:f,L:W,R:W,list:{index:l,high:s,next:null}};f===W?n.root=v:(v.low<f.low?f.L=v:f.R=v,t(v)),function(e,t){for(var o;0===t.P.C;)t.P===t.P.P.L?0===(o=t.P.P.R).C?(t.P.C=1,o.C=1,t.P.P.C=0,t=t.P.P):(t===t.P.R&&r(e,t=t.P),t.P.C=1,t.P.P.C=0,i(e,t.P.P)):0===(o=t.P.P.L).C?(t.P.C=1,o.C=1,t.P.P.C=0,t=t.P.P):(t===t.P.L&&i(e,t=t.P),t.P.C=1,t.P.P.C=0,r(e,t.P.P));e.root.C=1}(n,v),a[l]=v,n.size++},remove(s){var l=a[s];if(void 0!==l){delete a[s];var u=function(e,t){var r=e.list;if(r.index===t)return null===r.next?0:(e.list=r.next,1);var i=r;for(r=r.next;null!==r;){if(r.index===t)return i.next=r.next,1;i=r,r=r.next}}(l,s);if(void 0!==u){if(1===u)return l.high=l.list.high,e(l),t(l),void n.size--;var f,v=l,h=v.C;l.L===W?(f=l.R,o(n,l,l.R)):l.R===W?(f=l.L,o(n,l,l.L)):(h=(v=function(e){for(;e.L!==W;)e=e.L;return e}(l.R)).C,f=v.R,v.P===l?f.P=v:(o(n,v,v.R),v.R=l.R,v.R.P=v),o(n,l,v),v.L=l.L,v.L.P=v,v.C=l.C),e(f),t(f),1===h&&function(e,t){for(var o;t!==W&&1===t.C;)t===t.P.L?(0===(o=t.P.R).C&&(o.C=1,t.P.C=0,r(e,t.P),o=t.P.R),1===o.L.C&&1===o.R.C?(o.C=0,t=t.P):(1===o.R.C&&(o.L.C=1,o.C=0,i(e,o),o=t.P.R),o.C=t.P.C,t.P.C=1,o.R.C=1,r(e,t.P),t=e.root)):(0===(o=t.P.L).C&&(o.C=1,t.P.C=0,i(e,t.P),o=t.P.L),1===o.R.C&&1===o.L.C?(o.C=0,t=t.P):(1===o.L.C&&(o.R.C=1,o.C=0,r(e,o),o=t.P.L),o.C=t.P.C,t.P.C=1,o.L.C=1,i(e,t.P),t=e.root));t.C=1}(n,f),n.size--}}},search(e,t,r){for(var i=[n.root];0!==i.length;){var o=i.pop();if(o!==W&&e<=o.max&&(o.L!==W&&i.push(o.L),o.R!==W&&i.push(o.R),o.low<=t&&o.high>=e))for(var a=o.list;null!==a;)a.high<e||r(a.index,o.low),a=a.next}},get size(){return n.size}}}function a(){return(a=Object.assign||function(e){for(var t=1;arguments.length>t;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e}).apply(this,arguments)}function s(){var e=x.useState(H)[1];return x.useRef(()=>e({})).current}function l(e){var t,{positioner:r,resizeObserver:i,items:o,as:n="div",id:a,className:l,style:f,role:v="grid",tabIndex:h=0,containerRef:c,itemAs:d="div",itemStyle:m,itemHeightEstimate:p=300,itemKey:g=u,overscanBy:P=2,scrollTop:R,isScrolling:C,height:w,render:L,onRender:b}=e,M=0,z=s(),T=F(r,i),k=o.length,{columnWidth:I,columnCount:O,range:E,estimateHeight:W,size:j,shortestColumn:H}=r,N=j(),D=H(),J=[],Q="list"===v?"listitem":"grid"===v?"gridcell":void 0,U=y(b),V=R+(P*=w),X=V>D&&k>N;if(E(Math.max(0,R-P/2),V,(e,r,i)=>{var n=o[e],a=g(n,e),s={top:i,left:r,width:I,writingMode:"horizontal-tb",position:"absolute"};J.push(S(d,{key:a,ref:T(e),role:Q,style:"object"==typeof m&&null!==m?Object.assign({},s,m):s},B(L,e,n,I))),void 0===t?(M=e,t=e):(M=Math.min(M,e),t=Math.max(t,e))}),X)for(var Y=Math.min(k-N,Math.ceil((R+P-D)/p*O)),Z=N,$=q(I);N+Y>Z;Z++){var _=o[Z],ee=g(_,Z);J.push(S(d,{key:ee,ref:T(Z),role:Q,style:"object"==typeof m?Object.assign({},$,m):$},B(L,Z,_,I)))}x.useEffect(()=>{"function"==typeof U.current&&void 0!==t&&U.current(M,t,o),A="1"},[M,t,o,U]),x.useEffect(()=>{X&&z()},[X]);var te=G(C,W(k,p));return S(n,{ref:c,key:A,id:a,role:v,className:l,tabIndex:h,style:"object"==typeof f?K(te,f):te,children:J})}function u(e,t){return t}function f(e,t){void 0===e&&(e=0),void 0===t&&(t=12);var r=z(t),[i,o]=x.useState(0),n=x.useRef(0);return x.useEffect(()=>{1===n.current&&o(1);var e=0,r=b(()=>{e||o(0)},40+1e3/t);return n.current=1,()=>{e=1,M(r)}},[t,r]),{scrollTop:Math.max(0,r-e),isScrolling:i}}function v(e){var{scrollTop:t,isScrolling:r}=f(e.offset,e.scrollFps);return l({scrollTop:t,isScrolling:r,positioner:e.positioner,resizeObserver:e.resizeObserver,items:e.items,onRender:e.onRender,as:e.as,id:e.id,className:e.className,style:e.style,role:e.role,tabIndex:e.tabIndex,containerRef:e.containerRef,itemAs:e.itemAs,itemStyle:e.itemStyle,itemHeightEstimate:e.itemHeightEstimate,itemKey:e.itemKey,overscanBy:e.overscanBy,height:e.height,render:e.render})}function h(e,t){void 0===t&&(t=D);var[r,i]=x.useState({offset:0,width:0});return T(()=>{var{current:t}=e;if(null!==t){var o=0,n=t;do{o+=n.offsetTop||0,n=n.offsetParent}while(n);o===r.offset&&t.offsetWidth===r.width||i({offset:o,width:t.offsetWidth})}},t),r}function c(e,t){var{width:r,columnWidth:i=200,columnGutter:o=0,rowGutter:n,columnCount:a}=e;void 0===t&&(t=V);var s=()=>{var[e,t]=U(r,i,o,a);return J(t,e,o,null!=n?n:o)},l=x.useRef();void 0===l.current&&(l.current=s());var u=x.useRef(t),f=[r,i,o,n,a],v=x.useRef(f),h=!f.every((e,t)=>v.current[t]===e);if(h||!t.every((e,t)=>u.current[t]===e)){var c=l.current,d=s();if(u.current=t,v.current=f,h)for(var m=c.size(),p=0;m>p;p++){var g=c.get(p);d.set(p,void 0!==g?g.height:0)}l.current=d}return l.current}function d(e){function t(){return i.disconnect()}var r=s(),i=Y(e,r);return x.useEffect(()=>t,[i]),i}function m(e,t){var r,{align:i="top",element:o="undefined"!=typeof window&&window,offset:n=0,height:a=("undefined"!=typeof window?window.innerHeight:0)}=t,s=y({positioner:e,element:o,align:i,offset:n,height:a}),l=x.useRef(()=>{var e=s.current.element;return e&&"current"in e?e.current:e}).current,[u,f]=x.useReducer((e,t)=>{var r,i={position:e.position,index:e.index,prevTop:e.prevTop};if("scrollToIndex"===t.type)return{position:s.current.positioner.get(null!==(r=t.value)&&void 0!==r?r:-1),index:t.value,prevTop:void 0};if("setPosition"===t.type)i.position=t.value;else if("setPrevTop"===t.type)i.prevTop=t.value;else if("reset"===t.type)return Z;return i},Z),v=E(f,15);O(l(),"scroll",()=>{if(!u.position&&u.index){var e=s.current.positioner.get(u.index);e&&f({type:"setPosition",value:e})}});var h=void 0!==u.index&&(null===(r=s.current.positioner.get(u.index))||void 0===r?void 0:r.top);return x.useEffect(()=>{var e=l();if(e){var{height:t,align:r,offset:i,positioner:o}=s.current;if(u.position){var n=u.position.top;"bottom"===r?n=n-t+u.position.height:"center"===r&&(n-=(t-u.position.height)/2),e.scrollTo(0,Math.max(0,n+=i));var a=0,h=setTimeout(()=>!a&&f({type:"reset"}),400);return()=>{a=1,clearTimeout(h)}}if(void 0!==u.index){var c=o.shortestColumn()/o.size()*u.index;u.prevTop&&(c=Math.max(c,u.prevTop+t)),e.scrollTo(0,c),v({type:"setPrevTop",value:c})}}},[h,u,s,l,v]),x.useRef(e=>{f({type:"scrollToIndex",value:e})}).current}function p(e){var t=x.useRef(null),r=R({initialWidth:e.ssrWidth,initialHeight:e.ssrHeight}),i=h(t,r),o=Object.assign({offset:i.offset,width:i.width||r[0],height:r[1],containerRef:t},e);o.positioner=c(o),o.resizeObserver=d(o.positioner);var n=m(o.positioner,{height:o.height,offset:i.offset,align:"object"==typeof e.scrollToIndex?e.scrollToIndex.align:void 0}),a=e.scrollToIndex&&("number"==typeof e.scrollToIndex?e.scrollToIndex:e.scrollToIndex.index);return x.useEffect(()=>{void 0!==a&&n(a)},[a,n]),$(v,o)}function g(e){return _(p,a({role:"list",rowGutter:e.rowGutter,columnCount:1,columnWidth:1},e))}function P(e,t){void 0===t&&(t=te);var{isItemLoaded:r,minimumBatchSize:i=16,threshold:o=16,totalItems:n=9e9}=t,a=y(e),s=y(r);return x.useCallback((e,t,r)=>{for(var l=function(e,t,r,i,o,n){void 0===e&&(e=ee),void 0===t&&(t=16),void 0===i&&(i=9e9);for(var a,s,l=[],u=o;n>=u;u++)e(u,r)?void 0!==a&&void 0!==s&&(l.push(a,s),a=s=void 0):(s=u,void 0===a&&(a=u));if(void 0!==a&&void 0!==s){var f=Math.min(Math.max(s,a+t-1),i-1);for(u=s+1;f>=u&&!e(u,r);u++)s=u;l.push(a,s)}if(l.length)for(var v=l[0],h=l[1];t>h-v+1&&v>0;){var c=v-1;if(e(c,r))break;l[0]=v=c}return l}(s.current,i,r,n,Math.max(0,e-o),Math.min(n-1,(t||0)+o)),u=0;u<l.length-1;++u)a.current(l[u],l[++u],r)},[n,i,o,a,s])}import*as x from"react";import{useWindowSize as R}from"@react-hook/window-size";import C from"@essentials/memoize-one";import w from"@essentials/one-key-map";import y from"@react-hook/latest";import L from"trie-memoize";import{requestTimeout as b,clearRequestTimeout as M}from"@essentials/request-timeout";import z from"@react-hook/window-scroll";import T from"@react-hook/passive-layout-effect";import{ResizeObserver as k}from"@juggle/resize-observer";import I from"raf-schd";import O from"@react-hook/event";import{useThrottleCallback as E}from"@react-hook/throttle";var W={low:0,max:0,high:0,C:2,P:void 0,R:void 0,L:void 0,list:void 0};W.P=W,W.L=W,W.R=W;var j=new WeakMap,H={},S=x.createElement,A="0",B=L([w,{},WeakMap,w],(e,t,r,i)=>S(e,{index:t,data:r,width:i})),G=C((e,t)=>({position:"relative",width:"100%",maxWidth:"100%",height:Math.ceil(t),maxHeight:Math.ceil(t),willChange:e?"contents":void 0,pointerEvents:e?"none":void 0})),N=(e,t)=>e[0]===t[0]&&e[1]===t[1],K=C((e,t)=>Object.assign({},e,t),N),q=C(e=>({width:e,zIndex:-1e3,visibility:"hidden",position:"absolute",writingMode:"horizontal-tb"}),(e,t)=>e[0]===t[0]),F=C((e,t)=>r=>i=>{null!==i&&(t&&(t.observe(i),j.set(i,r)),void 0===e.get(r)&&e.set(r,i.offsetHeight))},N),D=[],J=function(e,t,r,i){void 0===r&&(r=0),void 0===i&&(i=r);for(var o=n(),a=new Array(e),s=[],l=new Array(e),u=0;e>u;u++)a[u]=0,l[u]=[];return{columnCount:e,columnWidth:t,set:function(e,n){void 0===n&&(n=0);for(var u=0,f=1;f<a.length;f++)a[f]<a[u]&&(u=f);var v=a[u]||0;a[u]=v+n+i,l[u].push(e),s[e]={left:u*(t+r),top:v,height:n,column:u},o.insert(v,v+n,e)},get:e=>s[e],update:t=>{for(var r=new Array(e),n=0,u=0;n<t.length-1;n++){var f=t[n],v=s[f];v.height=t[++n],o.remove(f),o.insert(v.top,v.top+v.height,f),r[v.column]=void 0===r[v.column]?f:Math.min(f,r[v.column])}for(n=0;n<r.length;n++)if(void 0!==r[n]){var h=l[n],c=Q(h,r[n]),d=l[n][c],m=s[d];for(a[n]=m.top+m.height+i,u=c+1;u<h.length;u++){var p=h[u],g=s[p];g.top=a[n],a[n]=g.top+g.height+i,o.remove(p),o.insert(g.top,g.top+g.height,p)}}},range:(e,t,r)=>o.search(e,t,(e,t)=>r(e,s[e].left,t)),estimateHeight:(t,r)=>{var i=Math.max(0,Math.max.apply(null,a));return t===o.size?i:i+Math.ceil((t-o.size)/e)*r},shortestColumn:()=>a.length>1?Math.min.apply(null,a):a[0]||0,size:()=>o.size,all:()=>s}},Q=(e,t)=>{for(var r=0,i=e.length-1;i>=r;){var o=r+i>>>1,n=e[o];if(n===t)return o;n>t?i=o-1:r=o+1}return-1},U=function(e,t,r,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=8),i=i||Math.floor(e/(t+r))||1,[Math.floor((e-r*(i-1))/i),i]},V=[],X="undefined"!=typeof window&&"ResizeObserver"in window?window.ResizeObserver:k,Y=L([WeakMap],(e,t)=>{var r=I(r=>{for(var i=[],o=0;o<r.length;o++){var n=r[o],a=n.target.offsetHeight;if(a>0){var s=j.get(n.target);if(void 0!==s){var l=e.get(s);void 0!==l&&a!==l.height&&i.push(s,a)}}}i.length>0&&(e.update(i),t(i))}),i=new X(r),o=i.disconnect.bind(i);return i.disconnect=()=>{o(),r.cancel()},i}),Z={index:void 0,position:void 0,prevTop:void 0},$=x.createElement,_=x.createElement,ee=(e,t)=>void 0!==t[e],te={};export{g as List,p as Masonry,v as MasonryScroller,n as createIntervalTree,J as createPositioner,Y as createResizeObserver,h as useContainerPosition,P as useInfiniteLoader,l as useMasonry,c as usePositioner,d as useResizeObserver,m as useScrollToIndex,f as useScroller};
//# sourceMappingURL=index.mjs.map
